# Caspers Universe Architecture

This document outlines the architecture of the caspers universe simulation system.

## Overview

We aim to generate a realistic dataset that describes the operations of a fictitious company
which operates ghost-kitchens. Operations refers to the various activities and processes that
the company undertakes to fulfill its mission as well as the interactions between the company
and its customers, employees, suppliers, and other stakeholders.

The aim is to provide a strong basis for showcasing how various data tools / platforms can be used
to analyze and visualize the data generated by the simulation and how data intelligence platforms
can be used to operate complex businesses.

The primary users of the system are:

- Operators
- Learners
- Educators

The operators are responsible for managing the simulation and ensuring that it runs smoothly.
They are also responsible for monitoring the simulation and making adjustments as needed.

Learners are people who want to learn about and experience the features of
a data intelligence platform. They can use the platform to analyze and visualize data
generated by the simulation.

Educators are people who want to teach about and experience the features of
a data intelligence platform. They can use the generated data to create
educational materials and teach others about the platform.

## Simulation

### Data Flow

When the simulation is running, it retains an internal state that is required to
drive the simulation. This includes state from then environment (people, locations, etc.)
as well as the data for operating caspers. This state can be snapshotted and used to
resume simulation state.

The simulation is driven by an agent-based environment model. Both people and physical assets
are agents operating in the environment. This model operates on a fixed time step. In each
simulation step the model generates a series of events that are used to update the state of
the simulation and further processed to enrich the generated data.

#### Agents

##### Population

People may take action based on triggers that are evaluated over their current state.
The state of a person includes their locations and potentially additional state
such as current level of hunger o.a. Whenever a person taken an action an event is
raised and a person may enter into an activity that spans multiple time steps
(e,g. delivering an order, eating a meal, ...).

##### Operations

- sites, kitechens, ...

### Simulation state

The in-memory state tracked by the simulation.

#### Operations Agent Data

The physical manifestation of casers operations is represented as metadata about
sites, the kitchens within a site and the vendors operating at a site. This data
is assumed to be slow moving and updates may require re-initializing or extending
the simulation state.

| object_id | object_type | object_data | object_status |
| --------- | ----------- | ----------- | ------------- |
| 1         | site        | {...}       | active        |
| 2         | kitchen     | {...}       | active        |
| 3         | vendor      | {...}       | active        |

#### Population Data

Around every operated site, we simulate a population that interacts with the
vendors / brands and the services offered by the ghost kitchen company. This
data is split into a slow moving metadata part (name, address, ...)

| person_id | fist_name | last_name | ... |
| --------- | --------- | --------- | --- |
| 1         | John      | Doe       | ... |

and a fast moving live data part that contains live locations for all individuals
as well as additional live state (e.g. last time eaten, ...)

| person_id | location             | state |
| --------- | -------------------- | ----- |
| 1         | { lng: 10, lat: 20 } | {...} |

#### Operations Data

The operations data tracks the live progress of orders and individual order line items.


### Data Outputs / Sinks

The generated datasets meant for consumption and demonstrate features.

#### Caspers Operational Data

The data that is tracked by the virtual business to coordinate operations.

#### Environmental data

Data that is generated as side effect of agents acting in the environment.

- courier location pings
- app usage telemetry data
- reactions / social media interactions
